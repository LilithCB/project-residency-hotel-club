<div class="min-h-screen bg-gray-100 flex flex-col justify-center items-center p-4">
  <div class="bg-white shadow-2xl rounded-3xl p-8 max-w-md w-full text-center">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Vincular WhatsApp</h1>
    <p class="text-gray-600 mb-6">Escanea el siguiente código QR con tu teléfono para conectar el servicio de mensajería.</p>
    
    <div class="bg-white p-4 rounded-xl inline-block shadow-inner mb-6">
      <img id="qr-image" src="/whatsapp-qr.png" alt="Código QR de WhatsApp" class="w-64 h-64 mx-auto">
    </div>

    <div class="text-left bg-gray-50 p-6 rounded-xl border border-gray-200">
      <h2 class="text-lg font-semibold text-gray-700 mb-3">Instrucciones:</h2>
      <ol class="list-decimal list-inside space-y-2 text-gray-600">
        <li>Abre WhatsApp en tu teléfono.</li>
        <li>Ve a <strong>Configuración</strong> > <strong>Dispositivos vinculados</strong>.</li>
        <li>Toca <strong>"Vincular un dispositivo"</strong>.</li>
        <li>Apunta la cámara de tu teléfono a este código QR.</li>
      </ol>
    </div>

    <p class="text-sm text-gray-500 mt-6">La página se recargará automáticamente una vez que la conexión sea exitosa.</p>
  </div>
</div>

<script>
  // Recargar la página cada 15 segundos para obtener un nuevo QR si expira
  setInterval(() => {
    // Añadimos un timestamp para evitar que el navegador cachee la imagen
    const qrImage = document.getElementById('qr-image');
    if (qrImage) {
      qrImage.src = '/whatsapp-qr.png?' + new Date().getTime();
    }
  }, 15000);

  // Comprobar si la conexión se ha establecido y redirigir
  setInterval(async () => {
    try {
      const response = await fetch('/api/whatsapp/status');
      const data = await response.json();
      if (data.connected) {
        window.location.href = '/login';
      }
    } catch (error) {
      console.error('Error verificando estado de WhatsApp:', error);
    }
  }, 5000);
</script>
